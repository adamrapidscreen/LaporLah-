# E3-S7: Build Feed Filter Bar

## Description
Build a client-side filter bar for the home feed that allows users to filter reports by category and status. Filters are persisted in URL search params for shareability and deep-linking. The filter bar sits above the report feed.

## Dependencies
- Stories: E3-S6
- Files: `src/app/page.tsx`, `src/lib/constants/categories.ts`, `src/lib/constants/statuses.ts`

## Tasks
1. `src/components/reports/report-feed.tsx`: Create Client Component with category dropdown, status dropdown, filter via URL search params (`useSearchParams` + `useRouter`). Wraps the filter bar UI
2. `src/app/page.tsx`: Update home page to read `searchParams` and apply filters to the Supabase query

## Implementation Notes

### Report Feed Filter Bar (`src/components/reports/report-feed.tsx`)
```typescript
'use client';

import { useSearchParams, useRouter, usePathname } from 'next/navigation';
import { useCallback } from 'react';
import { SlidersHorizontal } from 'lucide-react';

import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { Button } from '@/components/ui/button';
import { CATEGORIES } from '@/lib/constants/categories';
import { STATUSES } from '@/lib/constants/statuses';

export function ReportFeed() {
  const searchParams = useSearchParams();
  const router = useRouter();
  const pathname = usePathname();

  const currentCategory = searchParams.get('category') ?? 'all';
  const currentStatus = searchParams.get('status') ?? 'all';

  const updateFilter = useCallback(
    (key: string, value: string) => {
      const params = new URLSearchParams(searchParams.toString());
      if (value === 'all') {
        params.delete(key);
      } else {
        params.set(key, value);
      }
      router.push(`${pathname}?${params.toString()}`, { scroll: false });
    },
    [searchParams, router, pathname]
  );

  const clearFilters = useCallback(() => {
    router.push(pathname, { scroll: false });
  }, [router, pathname]);

  const hasFilters = currentCategory !== 'all' || currentStatus !== 'all';

  return (
    <div className="flex items-center gap-2 overflow-x-auto pb-2">
      <SlidersHorizontal className="h-4 w-4 shrink-0 text-muted-foreground" />

      {/* Category Filter */}
      <Select value={currentCategory} onValueChange={(v) => updateFilter('category', v)}>
        <SelectTrigger className="h-8 w-auto min-w-[120px] text-xs">
          <SelectValue placeholder="Category" />
        </SelectTrigger>
        <SelectContent>
          <SelectItem value="all">All Categories</SelectItem>
          {CATEGORIES.map((cat) => (
            <SelectItem key={cat.value} value={cat.value}>
              {cat.label}
            </SelectItem>
          ))}
        </SelectContent>
      </Select>

      {/* Status Filter */}
      <Select value={currentStatus} onValueChange={(v) => updateFilter('status', v)}>
        <SelectTrigger className="h-8 w-auto min-w-[100px] text-xs">
          <SelectValue placeholder="Status" />
        </SelectTrigger>
        <SelectContent>
          <SelectItem value="all">All Statuses</SelectItem>
          {STATUSES.map((status) => (
            <SelectItem key={status.value} value={status.value}>
              {status.label}
            </SelectItem>
          ))}
        </SelectContent>
      </Select>

      {/* Clear Filters */}
      {hasFilters && (
        <Button
          variant="ghost"
          size="sm"
          onClick={clearFilters}
          className="h-8 text-xs text-muted-foreground"
        >
          Clear
        </Button>
      )}
    </div>
  );
}
```

### Updated Home Page (`src/app/page.tsx`)
```typescript
import { createClient } from '@/lib/supabase/server';

import { ReportCard } from '@/components/reports/report-card';
import { ReportFeed } from '@/components/reports/report-feed';
import { EmptyState } from '@/components/shared/empty-state';

import type { Report } from '@/lib/types';

interface HomePageProps {
  searchParams: Promise<{ category?: string; status?: string }>;
}

export default async function HomePage({ searchParams }: HomePageProps) {
  const { category, status } = await searchParams;
  const supabase = await createClient();

  let query = supabase
    .from('reports')
    .select(`
      *,
      creator:users!user_id (
        id,
        full_name,
        avatar_url
      )
    `)
    .eq('is_hidden', false)
    .order('created_at', { ascending: false })
    .limit(20);

  // Apply filters
  if (category && category !== 'all') {
    query = query.eq('category', category);
  }
  if (status && status !== 'all') {
    query = query.eq('status', status);
  }

  const { data: reports } = await query;

  return (
    <div className="mx-auto max-w-lg px-4 py-4">
      {/* Filter Bar */}
      <ReportFeed />

      {/* Report List */}
      {!reports || reports.length === 0 ? (
        <EmptyState
          title="No reports found"
          description="Try adjusting your filters or be the first to report!"
        />
      ) : (
        <div className="mt-3 space-y-3">
          {(reports as Report[]).map((report) => (
            <ReportCard key={report.id} report={report} />
          ))}
        </div>
      )}
    </div>
  );
}
```

### URL Search Params Behavior
- `/` — no filters, show all reports
- `/?category=safety` — filter by safety category
- `/?status=open` — filter by open status
- `/?category=infrastructure&status=in_progress` — combined filters
- Filters are shareable — copying URL preserves active filters
- `router.push` with `{ scroll: false }` prevents scroll jump on filter change

### Design Specifications
- Filter bar: horizontal scroll (`overflow-x-auto`) for mobile
- Select triggers: compact `h-8`, `text-xs`
- Filter icon: `SlidersHorizontal` from Lucide
- Clear button: appears only when filters are active, ghost variant
- Gap between elements: `gap-2`

## Acceptance Criteria
- [ ] Category dropdown shows "All Categories" + 5 category options
- [ ] Status dropdown shows "All Statuses" + 5 status options
- [ ] Selecting a filter updates the URL search params
- [ ] Page re-renders with filtered results from Supabase
- [ ] Combined filters work (category + status simultaneously)
- [ ] "All" option in each dropdown removes that filter from URL
- [ ] Clear button appears when any filter is active
- [ ] Clear button removes all filters and resets to `/`
- [ ] Filters persist in URL for shareability (copy-paste URL preserves filters)
- [ ] Filter change does not scroll the page (`scroll: false`)
- [ ] Filter bar is horizontally scrollable on small screens
- [ ] Empty state shows when no reports match the active filters
- [ ] Component uses `'use client'` directive
- [ ] Named export: `ReportFeed`
