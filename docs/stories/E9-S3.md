# E9-S3: Build Flagged Items View

## Description
Create the flagged items admin page that lists reports and comments with flag counts and reasons. Provide action buttons for viewing, hiding/unhiding reports, and locking/unlocking comments.

## Dependencies
- Stories: E9-S1 (admin layout), E9-S5 (admin server actions)
- Files: `src/app/admin/layout.tsx`, `src/lib/actions/admin.ts`

## Tasks
1. `src/app/admin/flagged/page.tsx`: Create Server Component that:
   - Calls `getFlaggedItems()` from admin actions to get all flagged reports/comments
   - Renders a list of flagged items with flag count, reason summary, and item preview
   - Each item shows: type (report/comment), title/excerpt, flag count, most recent flag reason
   - Action buttons per item: View (link to report), Hide/Unhide toggle, Lock/Unlock Comments toggle
   - Show empty state when no flagged items exist
2. `src/components/admin/flagged-item-card.tsx`: Create Client Component for each flagged item with:
   - Item info display (type badge, title, flag count)
   - Flag reasons expandable section
   - Action buttons that call admin server actions
   - Optimistic UI for toggle actions
3. `src/components/admin/flagged-item-actions.tsx`: Create Client Component for action buttons (Hide/Unhide, Lock/Unlock) that call server actions with loading states

## Implementation Notes

### Flagged Items Page
```tsx
// src/app/admin/flagged/page.tsx
import { getFlaggedItems } from '@/lib/actions/admin';
import { FlaggedItemCard } from '@/components/admin/flagged-item-card';

export default async function FlaggedItemsPage() {
  const items = await getFlaggedItems();

  if (items.length === 0) {
    return (
      <div className="flex flex-col items-center justify-center py-12 text-center">
        <span className="text-6xl mb-4">üè≥Ô∏è</span>
        <h3 className="text-lg font-semibold">No flagged items</h3>
        <p className="text-sm text-muted-foreground">All clear! No reports or comments have been flagged.</p>
      </div>
    );
  }

  return (
    <div className="space-y-4">
      <h2 className="text-lg font-semibold">Flagged Items ({items.length})</h2>
      <div className="space-y-3">
        {items.map((item) => (
          <FlaggedItemCard key={item.id} item={item} />
        ))}
      </div>
    </div>
  );
}
```

### FlaggedItem Type
```typescript
interface FlaggedItem {
  id: string;
  type: 'report' | 'comment';
  reportId: string;
  title: string;         // report title or comment excerpt
  flagCount: number;
  reasons: string[];
  isHidden: boolean;
  commentsLocked: boolean;
  createdAt: string;
}
```

### Flagged Item Card
```tsx
// src/components/admin/flagged-item-card.tsx
'use client';

import { useTransition } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { hideReport, unhideReport, lockComments, unlockComments } from '@/lib/actions/admin';
import { Eye, EyeOff, Lock, Unlock, ExternalLink } from 'lucide-react';
import Link from 'next/link';

// Toggle buttons with loading state using useTransition
// Hide/Unhide: calls hideReport or unhideReport based on current isHidden state
// Lock/Unlock: calls lockComments or unlockComments based on current commentsLocked state
```

### Action Button Pattern
```tsx
const [isPending, startTransition] = useTransition();

const handleToggleHide = () => {
  startTransition(async () => {
    if (item.isHidden) {
      await unhideReport(item.reportId);
    } else {
      await hideReport(item.reportId);
    }
  });
};
```

## Acceptance Criteria
- [ ] Flagged items page renders at `/admin/flagged`
- [ ] Page lists all flagged reports and comments with flag counts
- [ ] Each item shows type (report/comment), title/excerpt, and flag count
- [ ] Flag reasons are visible for each item
- [ ] "View" button links to the report detail page
- [ ] "Hide/Unhide" toggle button calls appropriate server action
- [ ] "Lock/Unlock Comments" toggle button calls appropriate server action
- [ ] Empty state displays when no flagged items exist
- [ ] Action buttons show loading state during server action execution
- [ ] Page data is fetched server-side (page is Server Component)
