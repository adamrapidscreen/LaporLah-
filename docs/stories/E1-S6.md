# E1-S6: Deploy to Vercel — Verify Build, PWA, and OAuth Flow

## Description
Deploy the LaporLah application to Vercel. Configure environment variables, verify the production build succeeds, confirm PWA installability, and test the Google OAuth flow end-to-end.

## Dependencies
- Stories: E1-S1, E1-S2, E1-S3, E1-S4, E1-S5
- Files: All files from E1-S1 through E1-S5

## Tasks
1. Connect GitHub repository to Vercel via dashboard or `vercel` CLI
2. Configure environment variables in Vercel project settings:
   - `NEXT_PUBLIC_SUPABASE_URL`
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
   - `SUPABASE_SERVICE_ROLE_KEY`
   - `NEXT_PUBLIC_GOOGLE_CLIENT_ID`
3. Run `vercel build` or trigger deploy — verify build completes without errors
4. Configure Supabase Auth redirect URLs:
   - Add production URL to Supabase Auth > URL Configuration > Redirect URLs
   - Pattern: `https://<project>.vercel.app/auth/callback`
5. Configure Google OAuth consent screen:
   - Add production domain to authorized redirect URIs in Google Cloud Console
6. Verify PWA installability on production URL:
   - Check manifest loads correctly
   - Check service worker registers
   - Check install prompt appears
7. Test Google OAuth end-to-end:
   - Click sign in → redirected to Google → consent → callback → home page
   - Verify user record created in `users` table

## Implementation Notes

### Vercel CLI Deployment
```bash
# Install Vercel CLI
npm install -g vercel

# Deploy (follow prompts to connect project)
vercel

# Set environment variables
vercel env add NEXT_PUBLIC_SUPABASE_URL
vercel env add NEXT_PUBLIC_SUPABASE_ANON_KEY
vercel env add SUPABASE_SERVICE_ROLE_KEY
vercel env add NEXT_PUBLIC_GOOGLE_CLIENT_ID
```

### Supabase Auth Redirect Configuration
In Supabase Dashboard > Authentication > URL Configuration:
- Site URL: `https://<project>.vercel.app`
- Redirect URLs: `https://<project>.vercel.app/auth/callback`

### Build Verification Checklist
- Next.js build output shows all pages/routes
- No TypeScript errors in build log
- Service worker `sw.js` generated in public output
- No missing environment variable warnings

### Google Cloud Console Setup
- OAuth 2.0 Client ID > Authorized redirect URIs:
  - `https://<supabase-project>.supabase.co/auth/v1/callback`
- OAuth consent screen > Authorized domains:
  - `<project>.vercel.app`

## Acceptance Criteria
- [ ] Vercel deployment succeeds with no build errors
- [ ] Production URL loads the application correctly
- [ ] All environment variables are set in Vercel project settings
- [ ] PWA manifest is accessible at production URL `/manifest.json`
- [ ] Service worker registers successfully on production
- [ ] Browser shows PWA install prompt on supported devices
- [ ] Google OAuth flow completes: sign in → Google consent → callback → home
- [ ] User record is created in Supabase `users` table after first sign-in
- [ ] Subsequent sign-ins update (upsert) the user record
- [ ] Failed auth redirects to `/login?error=auth`
- [ ] HTTPS is enforced on the production URL
