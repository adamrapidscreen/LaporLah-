# E5-S2: Build Comment Form

## Description
Create a Client Component comment form with a text input and send button. The form wires to the `addComment` server action, which revalidates the page to show new comments. Handles locked comments and validates input length.

## Dependencies
- Stories: E5-S1 (comment list component)
- Files: `src/components/comments/comment-list.tsx`, `src/app/report/[id]/page.tsx`

## Tasks
1. `src/components/comments/comment-form.tsx`: Create Client Component with text input (Textarea or Input) and send button. Validate content (min 1 char, max 1000 chars). Show error message if `comments_locked` is true. Clear input on successful submit. Wire to `addComment` server action.
2. `src/app/report/[id]/page.tsx`: Integrate `CommentForm` below the `CommentList`, passing the report ID and `comments_locked` state.

## Implementation Notes

### Comment Form Component
```tsx
// src/components/comments/comment-form.tsx
'use client';

import { useRef, useOptimistic, useTransition } from 'react';
import { Button } from '@/components/ui/button';
import { Textarea } from '@/components/ui/textarea';
import { Send } from 'lucide-react';
import { addComment } from '@/lib/actions/comments';

interface CommentFormProps {
  reportId: string;
  commentsLocked: boolean;
}

export function CommentForm({ reportId, commentsLocked }: CommentFormProps) {
  const formRef = useRef<HTMLFormElement>(null);
  const [isPending, startTransition] = useTransition();
  const [error, setError] = useState<string | null>(null);

  if (commentsLocked) {
    return (
      <p className="py-4 text-center text-sm text-muted-foreground">
        Komen dikunci / Comments are locked
      </p>
    );
  }

  async function handleSubmit(formData: FormData) {
    const content = formData.get('content') as string;
    if (!content || content.trim().length === 0) {
      setError('Komen tidak boleh kosong / Comment cannot be empty');
      return;
    }
    if (content.length > 1000) {
      setError('Komen terlalu panjang (max 1000) / Comment too long');
      return;
    }

    setError(null);
    startTransition(async () => {
      const result = await addComment(reportId, content.trim());
      if (result?.error) {
        setError(result.error);
      } else {
        formRef.current?.reset();
      }
    });
  }

  return (
    <form ref={formRef} action={handleSubmit} className="flex gap-2">
      <Textarea
        name="content"
        placeholder="Tulis komen... / Write a comment..."
        className="min-h-[40px] resize-none"
        rows={1}
        maxLength={1000}
        disabled={isPending}
      />
      <Button type="submit" size="icon" disabled={isPending} className="shrink-0">
        <Send className="h-4 w-4" />
      </Button>
      {error && <p className="text-xs text-destructive">{error}</p>}
    </form>
  );
}
```


### Validation Rules
- Content: required, trimmed, min 1 character, max 1000 characters
- Client-side validation before calling server action
- Server-side validation via Zod in the server action (E5-S3)
- `comments_locked`: boolean flag from report â€” if true, show locked message instead of form

### Design Specifications
- Form layout: flex row with gap-2
- Textarea: single row, auto-resize feel, `min-h-[40px]`
- Send button: icon-only, `size="icon"`, Lucide `Send` icon
- Error text: `text-xs text-destructive`, shown below form
- Locked state: centered muted text, bilingual message
- Disabled state during submission (isPending)

## Acceptance Criteria
- [ ] Comment form renders with textarea and send button
- [ ] Form validates minimum 1 character (not empty/whitespace)
- [ ] Form validates maximum 1000 characters
- [ ] Error messages display in bilingual format
- [ ] Form clears after successful submission
- [ ] Send button is disabled during submission (loading state)
- [ ] Comments locked state shows locked message instead of form
- [ ] Form wires to `addComment` server action
- [ ] New comment appears after page revalidation
- [ ] Component uses 'use client' directive
- [ ] Form is integrated into the report detail page below the comment list
