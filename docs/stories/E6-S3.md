# E6-S3: Build Notification Bell Component

## Description
Create a Client Component notification bell with an unread count badge that subscribes to Supabase Realtime for live notification updates. Also create a reusable Realtime subscription hook.

## Dependencies
- Stories: E1-S3 (Supabase client setup), E2-S1/E2-S2 (navigation bars to place the bell)
- Files: `src/lib/supabase/client.ts`, navigation components

## Tasks
1. `src/lib/hooks/use-realtime.ts`: Create a custom hook that subscribes to a Supabase Realtime channel on a specified table, filtered by a column value. Return the subscription state and provide a callback for new inserts.
2. `src/components/notifications/notification-bell.tsx`: Create Client Component with a bell icon (Lucide `Bell`), absolute-positioned unread count badge (`bg-destructive`, `rounded-full`), subtle shake animation on new notification. Use the `useRealtime` hook to subscribe to the `notifications` table filtered by `user_id`. On INSERT, increment counter and optionally show a toast.
3. Integrate the bell into the main navigation bar(s).

## Implementation Notes

### Realtime Subscription Hook
```tsx
// src/lib/hooks/use-realtime.ts
'use client';

import { useEffect } from 'react';
import { createBrowserClient } from '@/lib/supabase/client';
import type { RealtimePostgresInsertPayload } from '@supabase/supabase-js';

interface UseRealtimeOptions<T> {
  table: string;
  filter?: string; // e.g., 'user_id=eq.xxx'
  onInsert?: (payload: RealtimePostgresInsertPayload<T>) => void;
}

export function useRealtime<T extends Record<string, unknown>>({
  table,
  filter,
  onInsert,
}: UseRealtimeOptions<T>) {
  useEffect(() => {
    const supabase = createBrowserClient();

    const channel = supabase
      .channel(`${table}-changes`)
      .on(
        'postgres_changes',
        {
          event: 'INSERT',
          schema: 'public',
          table,
          filter,
        },
        (payload) => {
          onInsert?.(payload as RealtimePostgresInsertPayload<T>);
        }
      )
      .subscribe();

    return () => {
      supabase.removeChannel(channel);
    };
  }, [table, filter, onInsert]);
}
```

### Notification Bell Component
```tsx
// src/components/notifications/notification-bell.tsx
'use client';

import { useState, useCallback } from 'react';
import Link from 'next/link';
import { Bell } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { cn } from '@/lib/utils';
import { useRealtime } from '@/lib/hooks/use-realtime';

interface NotificationBellProps {
  userId: string;
  initialUnreadCount: number;
}

export function NotificationBell({ userId, initialUnreadCount }: NotificationBellProps) {
  const [unreadCount, setUnreadCount] = useState(initialUnreadCount);
  const [shake, setShake] = useState(false);

  const handleInsert = useCallback(() => {
    setUnreadCount((prev) => prev + 1);
    setShake(true);
    setTimeout(() => setShake(false), 500);
  }, []);

  useRealtime({
    table: 'notifications',
    filter: `user_id=eq.${userId}`,
    onInsert: handleInsert,
  });

  return (
    <Button variant="ghost" size="icon" asChild className="relative">
      <Link href="/notifications">
        <Bell
          className={cn(
            'h-5 w-5',
            shake && 'animate-shake'
          )}
        />
        {unreadCount > 0 && (
          <span className="absolute -right-1 -top-1 flex h-4 min-w-4 items-center justify-center rounded-full bg-destructive px-1 text-[10px] font-bold text-destructive-foreground">
            {unreadCount > 99 ? '99+' : unreadCount}
          </span>
        )}
      </Link>
    </Button>
  );
}
```

### Shake Animation (add to globals.css or Tailwind config)
```css
@keyframes shake {
  0%, 100% { transform: rotate(0deg); }
  25% { transform: rotate(-10deg); }
  50% { transform: rotate(10deg); }
  75% { transform: rotate(-5deg); }
}

.animate-shake {
  animation: shake 0.5s ease-in-out;
}
```

### Design Specifications
- Bell icon: Lucide `Bell`, h-5 w-5
- Badge: absolute positioned, `-right-1 -top-1`, `bg-destructive`, `rounded-full`
- Badge text: `text-[10px] font-bold`, white on destructive background
- Badge min-width: `min-w-4` (16px) for single digits, grows for 2+ digits
- Max display: `99+` for counts over 99
- Shake animation: subtle rotation (10deg) for 500ms on new notification
- Links to `/notifications` page

### Realtime Subscription
- Subscribe to `notifications` table with filter `user_id=eq.{userId}`
- Listen for `INSERT` events only
- On new notification: increment unread counter, trigger shake animation
- Clean up subscription on component unmount

## Acceptance Criteria
- [ ] Notification bell renders with Lucide Bell icon
- [ ] Unread count badge shows when count > 0
- [ ] Badge displays count up to 99, then shows "99+"
- [ ] Badge is styled with `bg-destructive`, `rounded-full`, absolute positioned
- [ ] Bell has subtle shake animation when a new notification arrives
- [ ] `useRealtime` hook subscribes to Supabase Realtime on the `notifications` table
- [ ] Realtime filter is set to current user's `user_id`
- [ ] Unread count increments in real-time on new INSERT
- [ ] Subscription is cleaned up on component unmount
- [ ] Bell links to `/notifications` page
- [ ] `useRealtime` hook is generic and reusable for other tables
- [ ] Both components use 'use client' directive
