# E6-S1: Build Follow Button Component

## Description
Create a Client Component follow/unfollow toggle button with optimistic updates, follower count display, and heart/bookmark icon animation. The button wires to the `toggleFollow` server action.

## Dependencies
- Stories: E4-S1 (report detail page to place the button)
- Files: `src/app/report/[id]/page.tsx`

## Tasks
1. `src/components/shared/follow-button.tsx`: Create Client Component that toggles follow/unfollow state optimistically. Display follower count. Animate heart/bookmark icon on toggle (200ms fill animation). Wire to `toggleFollow` server action. Accept `reportId`, `initialFollowed`, and `initialCount` props.
2. `src/app/report/[id]/page.tsx`: Integrate `FollowButton` into the report detail page, querying current follow state and count for the logged-in user.

## Implementation Notes

### Follow Button Component
```tsx
// src/components/shared/follow-button.tsx
'use client';

import { useOptimistic, useTransition } from 'react';
import { Button } from '@/components/ui/button';
import { Heart } from 'lucide-react';
import { cn } from '@/lib/utils';
import { toggleFollow } from '@/lib/actions/follows';

interface FollowButtonProps {
  reportId: string;
  initialFollowed: boolean;
  initialCount: number;
}

export function FollowButton({
  reportId,
  initialFollowed,
  initialCount,
}: FollowButtonProps) {
  const [isPending, startTransition] = useTransition();
  const [optimistic, setOptimistic] = useOptimistic(
    { followed: initialFollowed, count: initialCount },
    (state, newFollowed: boolean) => ({
      followed: newFollowed,
      count: newFollowed ? state.count + 1 : state.count - 1,
    })
  );

  function handleToggle() {
    startTransition(async () => {
      setOptimistic(!optimistic.followed);
      await toggleFollow(reportId);
    });
  }

  return (
    <Button
      variant="ghost"
      size="sm"
      onClick={handleToggle}
      disabled={isPending}
      className="gap-1.5"
    >
      <Heart
        className={cn(
          'h-4 w-4 transition-all duration-200',
          optimistic.followed
            ? 'fill-destructive text-destructive scale-110'
            : 'fill-none text-muted-foreground scale-100'
        )}
      />
      <span className="text-sm text-muted-foreground">{optimistic.count}</span>
    </Button>
  );
}
```

### Integration in Detail Page
```tsx
// In src/app/report/[id]/page.tsx
// Fetch follow state for current user
const { data: { user } } = await supabase.auth.getUser();

let isFollowed = false;
let followCount = 0;

if (user) {
  const { data: follow } = await supabase
    .from('follows')
    .select('id')
    .eq('report_id', id)
    .eq('user_id', user.id)
    .maybeSingle();
  isFollowed = !!follow;
}

const { count } = await supabase
  .from('follows')
  .select('*', { count: 'exact', head: true })
  .eq('report_id', id);

followCount = count ?? 0;

// Render
<FollowButton
  reportId={id}
  initialFollowed={isFollowed}
  initialCount={followCount}
/>
```

### Animation Specifications
- Heart icon: Lucide `Heart` component
- Followed state: `fill-destructive text-destructive`, scale to 110% (`scale-110`)
- Unfollowed state: `fill-none text-muted-foreground`, normal scale (`scale-100`)
- Transition: `transition-all duration-200` (200ms ease)
- Count display: `text-sm text-muted-foreground`, next to icon

### Optimistic Update Pattern
- On click, immediately toggle visual state (filled/unfilled heart, count +/-1)
- Server action runs in background via `useTransition`
- If server action fails, React automatically reverts the optimistic state
- `useOptimistic` manages the temporary state during the transition

## Acceptance Criteria
- [ ] Follow button renders with heart icon and follower count
- [ ] Clicking toggles between followed (filled heart) and unfollowed (outline heart)
- [ ] Follower count updates optimistically (+1 on follow, -1 on unfollow)
- [ ] Heart icon has 200ms fill animation on toggle
- [ ] Button wires to `toggleFollow` server action
- [ ] Optimistic state reverts on server action failure
- [ ] Button is disabled during pending state
- [ ] Component accepts `reportId`, `initialFollowed`, and `initialCount` props
- [ ] Component uses 'use client' directive
- [ ] Follow button is integrated into the report detail page
- [ ] Non-authenticated users see the button but action requires login
