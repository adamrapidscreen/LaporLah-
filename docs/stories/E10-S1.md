# E10-S1: Create Seed Script with Realistic Demo Data

## Description
Create a database seed script that populates the LaporLah database with realistic Malaysian demo data including users, reports across all categories and statuses, comments, follows, confirmations, badges, and point events.

## Dependencies
- Stories: E1-S2 (all database tables), E8-S1 (badges/gamification tables)
- Files: `src/lib/supabase/server.ts`, Supabase migration files

## Tasks
1. `scripts/seed.ts`: Create TypeScript seed script that:
   - Uses Supabase admin client (service role key) to bypass RLS
   - Clears existing seed data (optional, with confirmation)
   - Inserts 3-4 demo users (1 admin, 2-3 regular users) with Malaysian names
   - Inserts 8-10 realistic reports across all 5 categories and multiple statuses
   - Inserts sample comments (2-3 per report on some reports)
   - Inserts follows (users following various reports)
   - Inserts confirmations on resolved reports
   - Inserts at least 1 badge award for a user
   - Inserts point events for report creation and other actions
   - All locations are real Malaysian locations (Cyberjaya, KL, Petaling Jaya, Shah Alam, Subang Jaya)
2. `supabase/migrations/004_seed_data.sql`: Create SQL alternative seed script with the same data
3. `package.json`: Add `"seed"` script: `"tsx scripts/seed.ts"`

## Implementation Notes

### Seed Script Structure
```typescript
// scripts/seed.ts
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;

const supabase = createClient(supabaseUrl, supabaseServiceKey);

async function seed() {
  console.log('ðŸŒ± Seeding database...');

  // 1. Clear existing data (reverse dependency order)
  await supabase.from('point_events').delete().neq('id', '');
  await supabase.from('notifications').delete().neq('id', '');
  await supabase.from('badges').delete().neq('id', '');
  await supabase.from('confirmations').delete().neq('id', '');
  await supabase.from('follows').delete().neq('id', '');
  await supabase.from('flags').delete().neq('id', '');
  await supabase.from('comments').delete().neq('id', '');
  await supabase.from('reports').delete().neq('id', '');

  // 2. Upsert users
  const users = [
    { id: 'user-1', email: 'ahmad@example.com', name: 'Ahmad bin Ibrahim', role: 'admin', points: 250, streak_count: 5, is_banned: false },
    { id: 'user-2', email: 'siti@example.com', name: 'Siti Nurhaliza', role: 'user', points: 180, streak_count: 3, is_banned: false },
    { id: 'user-3', email: 'raj@example.com', name: 'Raj Kumar', role: 'user', points: 90, streak_count: 1, is_banned: false },
    { id: 'user-4', email: 'mei@example.com', name: 'Tan Mei Ling', role: 'user', points: 45, streak_count: 0, is_banned: false },
  ];

  // 3. Insert reports
  const reports = [
    {
      user_id: 'user-2', title: 'Jalan berlubang besar di Persiaran APEC',
      description: 'Lubang jalan yang sangat besar dan berbahaya di Persiaran APEC, Cyberjaya. Sudah menyebabkan beberapa kemalangan kecil.',
      category: 'infrastructure', status: 'open',
      lat: 2.9213, lng: 101.6559, area_name: 'Cyberjaya, Selangor',
    },
    {
      user_id: 'user-3', title: 'Sampah bertimbun di taman permainan',
      description: 'Sampah tidak dikutip selama seminggu di taman permainan Taman Sri Serdang.',
      category: 'cleanliness', status: 'acknowledged',
      lat: 3.0319, lng: 101.6841, area_name: 'Seri Kembangan, Selangor',
    },
    {
      user_id: 'user-2', title: 'Lampu jalan rosak di Jalan SS15',
      description: 'Tiga lampu jalan berturut-turut tidak berfungsi menyebabkan kawasan gelap pada waktu malam.',
      category: 'safety', status: 'in_progress',
      lat: 3.0738, lng: 101.5883, area_name: 'Subang Jaya, Selangor',
    },
    {
      user_id: 'user-4', title: 'Tandas awam rosak di Dataran Merdeka',
      description: 'Tandas awam berhampiran Dataran Merdeka tidak boleh digunakan. Paip air bocor dan pintu rosak.',
      category: 'facilities', status: 'resolved',
      lat: 3.1480, lng: 101.6937, area_name: 'Kuala Lumpur',
      resolved_at: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),
    },
    {
      user_id: 'user-3', title: 'Longkang tersumbat di Taman Megah',
      description: 'Longkang utama di Taman Megah tersumbat menyebabkan banjir kilat setiap kali hujan lebat.',
      category: 'infrastructure', status: 'closed',
      lat: 3.1073, lng: 101.6108, area_name: 'Petaling Jaya, Selangor',
      resolved_at: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
    },
    // ... more reports for all categories
  ];

  // 4. Insert comments, follows, confirmations, badges, point_events
  console.log('âœ… Seeding complete!');
}

seed().catch(console.error);
```

### Demo Users
| Name | Role | Points | Context |
|------|------|--------|---------|
| Ahmad bin Ibrahim | admin | 250 | Admin user, active reporter |
| Siti Nurhaliza | user | 180 | Active reporter, has badges |
| Raj Kumar | user | 90 | Moderate activity |
| Tan Mei Ling | user | 45 | New user |

### Report Categories & Statuses Coverage
- Infrastructure (2 reports): 1 open, 1 closed
- Cleanliness (2 reports): 1 acknowledged, 1 open
- Safety (2 reports): 1 in_progress, 1 resolved
- Facilities (2 reports): 1 resolved, 1 acknowledged
- Other (2 reports): 1 open, 1 in_progress

### Malaysian Locations
- Cyberjaya (2.9213, 101.6559)
- Kuala Lumpur - Dataran Merdeka (3.1480, 101.6937)
- Petaling Jaya - Taman Megah (3.1073, 101.6108)
- Subang Jaya - SS15 (3.0738, 101.5883)
- Shah Alam (3.0733, 101.5185)
- Seri Kembangan (3.0319, 101.6841)

### SQL Seed Alternative
```sql
-- supabase/migrations/004_seed_data.sql
-- Same data as TypeScript seed but as SQL INSERT statements
-- Useful for running directly in Supabase SQL editor
```

## Acceptance Criteria
- [ ] Seed script runs with `npm run seed` (tsx scripts/seed.ts)
- [ ] 3-4 demo users created (1 admin, 2-3 regular users)
- [ ] 8-10 reports inserted across all 5 categories
- [ ] Reports cover multiple statuses (open, acknowledged, in_progress, resolved, closed)
- [ ] At least 1 report has status 'closed' (verified by community)
- [ ] Sample comments inserted on multiple reports
- [ ] Follow relationships created between users and reports
- [ ] Confirmations exist on resolved reports
- [ ] At least 1 user has a badge
- [ ] All locations are real Malaysian locations
- [ ] Descriptions are in Malay language (realistic content)
- [ ] SQL alternative seed file exists at `supabase/migrations/004_seed_data.sql`
- [ ] Script uses Supabase service role key to bypass RLS
