# E10-S1: Create Seed Script with Realistic Demo Data

## Description
Build a comprehensive seed script that populates the database with 8-10 realistic Malaysian community reports across all categories and statuses. Include demo users with badges, comments, follows, confirmations, point events, and notifications to showcase the full app functionality for judges and testers.

## Dependencies
- Stories: All E1-E9 stories (complete database schema, auth, gamification, admin)
- Files: `/supabase/migrations/*.sql` (all tables and functions must exist)

## Tasks
1. `scripts/seed.ts`: Create TypeScript seed script that:
   - Creates 4 demo users with realistic Malaysian names and profiles
   - Generates 10 reports across all 5 categories with real Malaysian locations
   - Represents all 6 status states (open, acknowledged, in_progress, resolved, closed, and at least one in confirmation voting)
   - Adds 20-25 natural conversational comments in Malaysian English
   - Creates follow relationships (2-8 followers per report)
   - Adds confirmation votes for resolved reports
   - Awards badges to at least one user (all 3 types at various tiers)
   - Creates point events that match user total_points
   - Generates notifications for various events (status changes, comments, follows, badge unlocks)
   - Sets up at least one user with a 3+ week streak
2. `package.json`: Add seed script command: `"seed": "tsx scripts/seed.ts"`
3. Ensure idempotency: script should be safe to run multiple times (use upserts or delete-first pattern)

## Implementation Notes

### Demo Users

Create 4 users with realistic profiles:

```typescript
const demoUsers = [
  {
    id: '11111111-1111-1111-1111-111111111111', // Fixed UUID for consistency
    email: 'admin@laporlah.my',
    full_name: 'Siti Nurhaliza',
    role: 'admin',
    total_points: 450,
    current_streak: 3,
    longest_streak: 5,
    // Admin user with all badges
  },
  {
    id: '22222222-2222-2222-2222-222222222222',
    email: 'ahmad@laporlah.my',
    full_name: 'Ahmad Faiz',
    role: 'user',
    total_points: 280,
    current_streak: 2,
    longest_streak: 4,
    // Active community member
  },
  {
    id: '33333333-3333-3333-3333-333333333333',
    email: 'mei.ling@laporlah.my',
    full_name: 'Mei Ling Tan',
    role: 'user',
    total_points: 120,
    current_streak: 1,
    longest_streak: 2,
    // Newer user
  },
  {
    id: '44444444-4444-4444-4444-444444444444',
    email: 'raj@laporlah.my',
    full_name: 'Rajesh Kumar',
    role: 'user',
    total_points: 90,
    current_streak: 0,
    longest_streak: 1,
    // Casual user
  }
];
```

### Report Data Structure

All 5 categories must be represented:

```typescript
const reports = [
  {
    title: 'Broken streetlight on Persiaran Multimedia',
    description: 'The streetlight near Block A has been out for 3 days. Very dark at night, safety concern for residents walking home.',
    category: 'infrastructure',
    status: 'open',
    latitude: 2.9188,
    longitude: 101.6538,
    area_name: 'Cyberjaya, Selangor',
  },
  {
    title: 'Overflowing bins at Putrajaya Central Park',
    description: 'Rubbish bins near the lake are overflowing. Smells bad and attracting flies. Needs urgent collection.',
    category: 'cleanliness',
    status: 'acknowledged',
    latitude: 2.9264,
    longitude: 101.6964,
    area_name: 'Putrajaya',
  },
  {
    title: 'Pothole causing accidents on Jalan PJS 7',
    description: 'Large pothole on main road near the traffic light. Already saw 2 motorcycles nearly fall. Please fix ASAP!',
    category: 'infrastructure',
    status: 'in_progress',
    latitude: 3.1073,
    longitude: 101.6067,
    area_name: 'Petaling Jaya, Selangor',
  },
  {
    title: 'Park playground equipment broken',
    description: 'Swing set at Taman Tasik Shah Alam is broken and rusted. Not safe for kids. Needs repair or replacement.',
    category: 'facilities',
    status: 'resolved', // Will have confirmation votes
    latitude: 3.0733,
    longitude: 101.5185,
    area_name: 'Shah Alam, Selangor',
    resolved_at: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(), // 1 day ago
  },
  {
    title: 'Stray dogs causing safety concerns',
    description: 'Pack of stray dogs roaming near the park. They bark aggressively at joggers. Please relocate them safely.',
    category: 'safety',
    status: 'resolved',
    latitude: 3.0565,
    longitude: 101.5853,
    area_name: 'Subang Jaya, Selangor',
    resolved_at: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(), // 5 days ago
  },
  // Add 5 more reports for other, infrastructure, cleanliness, safety, facilities
];
```

### Malaysian English Comment Style

Comments should sound natural and conversational:

```typescript
const comments = [
  'Ya lah, I also noticed this! Very dangerous especially at night.',
  'Thank you for reporting! Hope they fix it soon.',
  'Wah, this one really urgent. I nearly accident there yesterday.',
  'Any update on this? Still not fixed ah?',
  'Good news! Just saw the workers there this morning üëç',
  'Aiyo why so long to fix? Already reported so many times.',
  'Agreed! This area always like that one. Need better maintenance.',
];
```

### Badge Awards

At least one user (Siti Nurhaliza) should have all badges:

```typescript
const badges = [
  { user_id: siti.id, type: 'spotter', tier: 'gold' },    // 10+ reports
  { user_id: siti.id, type: 'kampung_hero', tier: 'gold' }, // 5+ resolved
  { user_id: siti.id, type: 'closer', tier: 'silver' },   // 3+ confirmations
  { user_id: ahmad.id, type: 'spotter', tier: 'bronze' },  // 3+ reports
];
```

### Point Events

Points must match user total_points:

```typescript
// For Siti (450 points):
// - 10 reports √ó 25 = 250
// - 2 resolved (as resolver) √ó 15 = 30
// - 5 comments √ó 5 = 25
// - 3 confirmations √ó 10 = 30
// - 2 report_closed (as creator) √ó 25 = 50
// - 3 follows √ó 5 = 15
// - Badge unlocks √ó 10 = 50
// Total: 450 ‚úì
```

### Confirmation Voting

One report should be in active confirmation voting:

```typescript
// Report resolved 1 day ago, needs community confirmation
// Add 3 "confirmed" votes and 1 "not_yet" vote
// Still needs 2 more "confirmed" to auto-close
```

### Idempotency Pattern

Use delete-first or upsert pattern:

```typescript
// At start of script:
await supabase.from('point_events').delete().gte('id', '00000000-0000-0000-0000-000000000000');
await supabase.from('notifications').delete().gte('id', '00000000-0000-0000-0000-000000000000');
await supabase.from('badges').delete().gte('id', '00000000-0000-0000-0000-000000000000');
await supabase.from('confirmations').delete().gte('id', '00000000-0000-0000-0000-000000000000');
await supabase.from('follows').delete().gte('id', '00000000-0000-0000-0000-000000000000');
await supabase.from('flags').delete().gte('id', '00000000-0000-0000-0000-000000000000');
await supabase.from('comments').delete().gte('id', '00000000-0000-0000-0000-000000000000');
await supabase.from('reports').delete().gte('id', '00000000-0000-0000-0000-000000000000');

// For users, use upsert with fixed UUIDs:
await supabase.from('users').upsert(demoUsers, { onConflict: 'id' });
```

### Script Execution

```bash
# Install tsx if not already
npm install -D tsx

# Run seed script
npm run seed

# Or directly
npx tsx scripts/seed.ts
```

## Acceptance Criteria
- [ ] Seed script creates exactly 4 demo users with Malaysian names
- [ ] 10 reports span all 5 categories (infrastructure, cleanliness, safety, facilities, other)
- [ ] All 6 status states are represented (open, acknowledged, in_progress, resolved, closed, + at least one in confirmation voting)
- [ ] 20-25 comments in natural Malaysian English conversational style
- [ ] Each report has 2-8 followers
- [ ] At least 1 report has active confirmation votes (3+ votes, not yet closed)
- [ ] Siti Nurhaliza has all 3 badge types (spotter, kampung_hero, closer) at various tiers
- [ ] At least 1 user has current_streak ‚â• 3 and longest_streak ‚â• 3
- [ ] Point events sum matches each user's total_points exactly
- [ ] Notifications exist for status changes, comments, follows, and badge unlocks
- [ ] Siti Nurhaliza has role = 'admin' for testing admin dashboard
- [ ] Script can be run multiple times without errors (idempotent)
- [ ] All locations use real Malaysian coordinates and area names
- [ ] Script outputs progress messages (e.g., "‚úì Created 4 users", "‚úì Created 10 reports")
- [ ] Feed page shows diverse, realistic content immediately after seeding
- [ ] Admin dashboard shows populated stats and flagged items (add 1-2 flags)
